
class User
  include Mongoid::Document
  include Mongoid::Attributes::Dynamic
  include CardMultiple
  include ActiveModel::SecurePassword

  has_secure_password

  has_and_belongs_to_many :tradeable_cards, class_name: 'Card', inverse_of: :tradeable_by
  has_and_belongs_to_many :wanted_cards, class_name: 'Card', inverse_of: :wanted_by    
  has_many :comments
  has_one :card_multiple

  field :first_name, type: String
  field :last_name,  type: String
  field :email,      type: String
  field :dci_number, type: Integer
  field :password_digest, type: String

end

class Trade
  include Mongoid::Document
  include Mongoid::Attributes::Dynamic

  belongs_to :initiator, class_name: 'User'
  belongs_to :receiver, class_name: 'User'
  has_many :comments

  field :initiator_cards, type: Array, default: []
  field :receiver_cards, type: Array, default: []

  # {
  #   trade: [
  #     [User, [cards]],
  #     [User, [cards]],
  #   ]
  #   comments: [ Comment, ... ],
  # }

end

class Comment
  include Mongoid::Document
  include Mongoid::Attributes::Dynamic 
  
  belongs_to :trade
  belongs_to :user

  field :content, type: String

end

class CardSet
  include Mongoid::Document
  include Mongoid::Attributes::Dynamic

  has_many :cards
  
end

class CardMultiple
  include Mongoid::Document
  include Mongoid::Attributes::Dynamic
  include CardMultipleModule

  belongs_to :user
  
  field :tradeable_copies, type: Array, default: []
  field :wanted_copies, type: Array, default: []

end

class Card
  include Mongoid::Document
  include Mongoid::Attributes::Dynamic

  belongs_to :card_set
  has_and_belongs_to_many :tradeable_by, class_name: 'User', inverse_of: :tradeable_cards
  has_and_belongs_to_many :wanted_by, class_name: 'User', inverse_of: :wanted_cards

end
